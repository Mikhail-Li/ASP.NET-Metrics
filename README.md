# ASP.NET-Metrics
ASP.NET Core WebApi Metrics-Manager

preview.png

## Сервис по сбору метрик

Предназначен для сбора, накопления, предоставления и отображения данных по различным метрикам с ПК и Серверов.

Состоит из Агентов сбора метрик, Менеджера метрик и пользовательского интерфейса. 

### Функционал Агента сбора метрик:
1. Получение метрик _CPU_ (% загруженности), _GcHeapSize_ (garbage collector, байт во всех кучах(Heaps), _Hdd_ (Всего свободно Mбайт на дисках), _Network_ (Всего байт в секунду на сетевых адаптерах), _RAM_ (доступно Мбайт) с Hosts, на котором функционирует.
2. Запись метрик в базу данных **metrics.db** (тип SQLite).
3. Получение и предоставление по запросу архивных метрик из БД за определенный период времени.

### Функционал Менеджера сбора метрик:
1. Регистрация агентов сбора метрик.
2. Вывод списка всех зарегистрированных агентов сбора метрик.
3. Возвращение адреса агента по  его Id.
4. Получение метрик _CPU_, _GcHeapSize_, _Hdd_, _Network_, _RAM_ с зарегистрированных Агентов сбора метрик.
5. Запись метрик в базу данных **managermetrics.db** (тип SQLite).
6. Получение и предоставление по запросу архивных метрик из БД за определенный период времени по выбранному агнету или по всем агентам.


### Алгоритм работы:

Указание адреса Агента или Менеджера осуществляется:
- _Url_ в файле **appsettings.json** (используется кроссплатформенный ASP.NET Core веб-сервер Kestrel). 
- _applicationUrl_ - в файле **launchSettings.json** (используется IIS Express веб-сервер).

Пример: _"http://localhost:55558"_

После запуска Агент в автоматическом режиме собирает метрики и записывает их в БД с периодичностью 3 или 5 секунд в зависимолсти от метрики.
 
При запуске Менеджера метрик по всем зарегистрированным агентам происходит проверка и обновление данных в БД менеджера метрик.

Структура запросов, примеры с описаниями представлены по средствам **Swagger UI** (Например доступен по адресу: http://localhost:55558/index.html). Metrics_Swagger.png

Например: 
Запрос HTTP-GET для контроллера **CpuMetricsControllerApi**: 
Структура запроса: _​/api​/metrics​/cpu​/frombase​/agent​/{agentId}​/from​/{fromTime}​/to​/{toTime}_
Цель запроса: Получает метрики CPU (% загруженности) из базы Менеджера метрик по выбранному Агенту сбора метрик на заданном диапазоне времени
Пример: _http://localhost:55558/api/metrics/cpu/frombase/agent/1/from/2021-10-18T18%3A50%3A00/to/2021-10-18T18%3A52%3A00_

Для графического представления результатов реализован UI с использованием WPF. Metrics.png

#### Прочее:

При реализации проекта написаны 38 Unit-tests для Агентов и Менеджера метрик.
Использованы:
- FluentMigrator;
- Moq;
- AutoMapper;
- Dapper;
- LiveCharts;
- Quartz и др.
